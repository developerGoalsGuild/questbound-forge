## 22.4 – User-created quests
**Labels:** `Phase 1 – Foundation` (sky)

**Dependencies:**

> Depends on: 11.x Goals (schema + CRUD), 15.x Tasks (patterns), 17.x Progress & Milestones (read-only integration)

### Description
Objective: Implement a new feature allowing a user to create and manage personal "Quests" that belong to them and can include any combination of goals and/or tasks. Quests are gamified action units that can span multiple goals and tasks, with difficulty and reward mechanics to support future gamification.

Scope: Backend (API Gateway + Lambda + AppSync), DynamoDB single-table design, frontend API contracts, validation, logging, testing, and documentation. No caching or background workers in this slice.

Notes:
- Keep current milestone behavior unchanged (system-generated only).
- Quests belong to users and can link to any combination of goals and/or tasks owned by the user.
- Follow repository API header and error logging standards for frontend integration.

---

### Data Model — DynamoDB (Single-table)
Table: `gg_core`

Entity: Quest (related to Goals and/or Tasks)

Keys
- Base ownership key: `PK = USER#<userId>`
- Sort key: `SK = QUEST#<questId>`
  - Note: We keep the primary entity owned by the user to allow unified listings and immutability checks. Links to goals/tasks are stored as attributes.

GSIs (re-use existing)
- `GSI1PK = USER#<userId>`
- `GSI1SK = ENTITY#Quest#<createdAtISO>`

Attributes (camelCase)
- `type: "Quest"`
- `id: string` (ULID/UUID)
- `userId: string`
- `title: string` (max 100 chars, sanitized)
- `description?: string` (max 500 chars, sanitized, XSS-protected)
- `difficulty: "easy"|"medium"|"hard"`
- `rewardXp: number` (default 50, min 0, max 1000)
- `status: "draft"|"active"|"completed"|"cancelled"|"failed"` (draft=editable, active+=immutable)
- `category: string` (required, validated against predefined list)
- `tags: string[]` (default [], max 10 tags, each max 20 chars, sanitized)
- `privacy: "public"|"followers"|"private"` (default "private", controls quest template sharing)
- `deadline?: number` (ms epoch) — quest has its own deadline
- `createdAt: number` (ms epoch)
- `updatedAt: number` (ms epoch)
- `version: number` (optimistic locking, starts at 1)
- `auditTrail: object[]` (array of audit events for compliance)

Linking (any combination allowed)
- `linkedGoalIds?: string[]` — zero or more goal IDs (own goals + permitted external goals)
- `linkedTaskIds?: string[]` — zero or more task IDs (own tasks only)
- `dependsOnQuestIds?: string[]` — zero or more quest IDs (own quests only)
- **Cross-user linking rules**:
  - Goals: Can link to other users' goals ONLY if:
    1. Goal owner has explicitly granted "quest_linking" permission
    2. Users have mutual follow relationship
    3. Goal is not marked as "private" for quest linking
    4. Permission is verified on every quest operation
  - Tasks: Can only link to own tasks (tasks are always goal-owned)
  - Quest Dependencies: Can only depend on own quests (quest chains within same user)

Behavior Mode
- `kind: "linked" | "quantitative"`
- For `linked` quests:
  - Success rule: all linked items must be complete (goals/tasks)
  - Pre-start completions count toward success
  - Dependencies: all dependent quests must be completed before quest can be started
- For `quantitative` quests:
  - `targetCount: number` — required
  - `countScope: "any" | "linked"` — whether to count any user tasks or only tasks within linked set/goals
  - `startAt: number` (ms epoch) — quest start
  - `periodSeconds: number` — counting window duration
  - Only completions within `[startAt, startAt + periodSeconds]` count

Access Patterns
- List user quests: Query `GSI1` where `GSI1PK=USER#<userId>` and `begins_with(GSI1SK, 'ENTITY#Quest#')`.
- Get specific quest: `PK=USER#<userId>`, `SK=QUEST#<questId>`.
- Filter by linkedGoalIds/linkedTaskIds client-side or via secondary patterns if needed in future slices.

Constraints
- Caller must own all linked Tasks; can link to external Goals only with explicit permission + mutual follow + privacy check.
- `title` required (3-100 chars, sanitized); `difficulty` in {easy, medium, hard}; `rewardXp` >= 0 and <= 1000.
- Draft quests are editable; active+ quests are immutable except cancellation; deletion requires admin role.
- All text inputs must be sanitized and XSS-protected.
- Rate limiting: 10 quest creations per hour per user, 100 quest operations per hour per user.
- Input validation: All fields validated server-side with strict schemas.

---

### GraphQL Schema (AppSync)
Additions (reads and writes):

```graphql
enum QuestStatus {
  draft
  active
  completed
  cancelled
  failed
}

enum QuestKind {
  linked
  quantitative
}

enum QuestCountScope {
  any
  linked
}

type Quest {
  id: ID!
  userId: ID!
  title: String!
  description: String
  difficulty: String!
  rewardXp: Int!
  status: QuestStatus!
  category: String!
  tags: [String!]!
  privacy: String!
  deadline: AWSTimestamp
  createdAt: AWSTimestamp!
  updatedAt: AWSTimestamp!
  kind: QuestKind!
  linkedGoalIds: [ID!]
  linkedTaskIds: [ID!]
  dependsOnQuestIds: [ID!]
  # Quantitative fields
  targetCount: Int
  countScope: QuestCountScope
  startAt: AWSTimestamp
  periodSeconds: Int
}
 
extend type Query {
  myQuests(goalId: ID!): [Quest!]!
}

```

Resolver Patterns
- Reads via AppSync DDB resolvers:
  - `myQuests`: VTL/JS resolver → DynamoDB Query on `GSI1` by user with ownership check via `identity.resolverContext?.sub || identity.sub`.
  - All queries include audit logging and rate limiting checks.
- Writes via API Gateway → Quest Service Lambda:
- `POST /quests/createQuest` → Quest Service Lambda → DynamoDB PutItem (creates as draft)
- `POST /quests/quests/{id}/start` → Quest Service Lambda → DynamoDB UpdateItem (draft → active)
- `PUT /quests/quests/{id}` → Quest Service Lambda → DynamoDB UpdateItem (edit draft only)
- `POST /quests/quests/{id}/cancel` → Quest Service Lambda → DynamoDB UpdateItem (active → cancelled)
- `POST /quests/quests/{id}/fail` → Quest Service Lambda → DynamoDB UpdateItem (active → failed)
- `DELETE /quests/quests/{id}` → Quest Service Lambda → DynamoDB DeleteItem (admin-only)
- All write operations include:
  - Input validation and sanitization
  - Authorization checks (ownership + permissions)
  - Rate limiting enforcement
  - Audit trail logging
  - Optimistic locking with version control

---

### REST Endpoints (API Gateway → Quest Service Lambda)
Write operations are handled via API Gateway → Quest Service Lambda:

- `POST /quests/createQuest` → Create a Quest (body: QuestCreatePayload, creates as draft)
- `POST /quests/quests/{id}/start` → Start Quest (draft → active)
- `PUT /quests/quests/{id}` → Edit Quest (draft only, body: QuestUpdatePayload)
- `POST /quests/quests/{id}/cancel` → Cancel Quest (active → cancelled)
- `POST /quests/quests/{id}/fail` → Mark Quest as Failed (active → failed)
- `DELETE /quests/quests/{id}` → Delete Quest (admin-only)

Request Headers (always include)
```http
Content-Type: application/json
Authorization: Bearer <token>
x-api-key: <gateway-key>
x-request-id: <uuid>
x-client-version: <version>
```

Security Headers (API Gateway)
```http
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains
Content-Security-Policy: default-src 'self'
```

Error Logging (frontend pattern)
- On non-2xx, log structured object with status, url, input (minus secrets), and timestamp; throw message from `detail` when present.
- All errors include request ID for tracing and correlation.
- Sensitive data (tokens, personal info) is redacted from logs.

---

### Backend — Quest Service Lambda (Python FastAPI)
Models (Pydantic)
- `QuestCreatePayload`:
  - Common: title, description?, difficulty, rewardXp?, tags?, deadline?
  - Linking: linkedGoalIds?, linkedTaskIds?
  - Mode: kind ('linked' | 'quantitative')
  - Quantitative: targetCount?, countScope?, startAt?, periodSeconds?
- `QuestCancelPayload` (optional reason?)
- `QuestResponse` (mirrors GraphQL `Quest`)

Lambda Handler (Quest Service)
- Extend existing quest-service Lambda to handle Quest operations:
  - Operations: `createQuest`, `cancelQuest`, `deleteQuest` (admin)
  - Validate input, verify ownership (linked entities belong to `userId`), perform DDB writes with conditional expressions
  - Automatic completion evaluation on create/cancel and on relevant task/goal updates (triggered by those flows)
  - **Security Enhancements**:
    - Input sanitization and XSS protection
    - Rate limiting enforcement per user
    - JWT token validation and role verification
    - Cross-user permission verification for goal linking
    - Audit trail logging for all operations
    - Optimistic locking with version control
    - Comprehensive error handling without information disclosure

Validation Rules
- `title` non-empty (3-100 chars), sanitized; `difficulty` ∈ {easy, medium, hard}
- `rewardXp` ≥ 0 and ≤ 1000; `deadline` (if present) should be ≥ now + 1 hour
- `description` max 500 chars, XSS-sanitized; `tags` max 10 items, each max 20 chars
- For linked quests: linked items must exist, belong to caller, and have proper permissions
- For quantitative quests: require `targetCount > 0`, `startAt` and `periodSeconds > 0`
- All string inputs validated against XSS patterns and SQL injection patterns
- Rate limiting: 10 creations/hour, 100 operations/hour per user

Ownership & Security
- Use `sub` from API Gateway Lambda authorizer (existing pattern) to resolve `userId`
- Verify JWT token validity, expiration, and refresh requirements
- Quests must write base keys and `GSI1PK/GSI1SK` for user listings
- Cross-user goal linking requires explicit permission verification
- Admin operations require `admin` role in JWT claims
- All operations include audit trail logging with user context

Logging
- Structured logs: `quests.createQuest_start|success|failed`, `quests.updateQuest_*`, `quests.deleteQuest_*`
- All logs include: requestId, userId, operation, timestamp, IP address (anonymized)
- Security events logged separately: `security.quest_access_denied`, `security.quest_permission_violation`
- Audit trail stored in DynamoDB for compliance requirements

---

### Frontend — API Contracts & Types (GraphQL read, REST write)
Models (`frontend/src/models/quest.ts`)
```ts
export interface Quest {
  id: string;
  goalId: string;
  userId: string;
  title: string;
  description?: string;
  difficulty: 'easy' | 'medium' | 'hard';
  rewardXp: number;
  status: 'active' | 'paused' | 'completed' | 'cancelled';
  tags: string[];
  dueAt?: number;
  createdAt: number;
  updatedAt: number;
}

export interface QuestCreateInput {
  goalId: string;
  title: string;
  description?: string;
  difficulty?: 'easy' | 'medium' | 'hard';
  rewardXp?: number;
  tags?: string[];
  dueAt?: number;
}

export interface QuestUpdateInput {
  title?: string;
  description?: string;
  difficulty?: 'easy' | 'medium' | 'hard';
  rewardXp?: number;
  tags?: string[];
  status?: 'active' | 'paused' | 'completed' | 'cancelled';
  dueAt?: number;
}
```

GraphQL Operations (reads)
- Query `myQuests(goalId: ID!): [Quest!]!` (optionally add filters later)

API Services (`frontend/src/lib/apiQuest.ts`)
- GraphQL: Wrap Apollo/Amplify calls with error handling for `myQuests` (reads)
- REST: Implement `createQuest`, `cancelQuest`; expose `deleteQuest` only for admin surfaces

Error Handling
- On GraphQL errors, log structured details (operation name, variables, timestamp) and surface user-friendly messages

## Frontend Specification

### UI Components & Pages

#### Quest Management Components
- **QuestDashboard**: Dedicated quest management page with overview and analytics
- **QuestList**: Display user's quests with filtering and sorting options
- **QuestCard**: Individual quest display with status, progress, and actions
- **QuestCreateForm**: Modal/form for creating new quests (linked/quantitative)
- **QuestDetails**: Detailed view of quest with linked goals/tasks
- **QuestProgress**: Progress visualization for quantitative quests
- **QuestFilters**: Filter by status, difficulty, category, linked goals/tasks
- **GoalQuestIntegration**: Quest section within goal detail views

#### Quest Creation Flow (Multi-Step Wizard)
- **Step 0 - Template Selection**: Choose from pre-defined templates or start from scratch
- **Step 1 - Basic Information**: Title, description, category, difficulty, reward XP, deadline
- **Step 2 - Quest Type Selection**: Choose between "linked" or "quantitative" quests
- **Step 3 - Quest Configuration**: 
  - For linked quests: Select goals and/or tasks to link
  - For quantitative quests: Set target count, scope, start date, period
- **Step 4 - Preview & Confirmation**: Show quest summary before creation
- **Validation**: Real-time validation with clear error messages at each step

#### Pre-defined Quest Templates
- **"Complete 5 tasks this week"** (Quantitative: 5 tasks, 7 days, any scope)
- **"Finish all tasks in [Goal Name]"** (Linked: All tasks in selected goal)
- **"Complete 3 goals this month"** (Quantitative: 3 goals, 30 days, any scope)
- **"Daily task completion"** (Quantitative: 1 task, 1 day, any scope)
- **"Weekly goal progress"** (Quantitative: 1 goal, 7 days, any scope)
- **"Start from scratch"** (Empty template for custom quests)

**Note**: Quest duplication is not supported - users create quests from templates or scratch only.

#### Quest Archiving & Deletion
- **User-controlled preferences**: Users can set their own archiving/deletion preferences
- **Options available**:
  - Archive completed/cancelled quests indefinitely
  - Delete after 30/60/90/180 days
  - Keep visible indefinitely
  - Manual archiving/deletion controls

#### Quest Notifications
- **User-configurable preferences**: Users can choose notification types and frequency
- **Notification types available**:
  - In-app notifications (quest progress, completion, failure)
  - Email notifications (daily/weekly summaries, important updates)
  - Push notifications (mobile, real-time quest updates)
- **Notification triggers**:
  - Quest started/completed/failed
  - Quest progress milestones (25%, 50%, 75%)
  - Quest deadline approaching (24h, 1h warnings)
  - Quest dependency resolved (can start dependent quest)
  - Quest expiration warnings (24h, 48h, 72h after deadline)

#### Quest Streaks & Rewards
- **Streak tracking**: Both daily and weekly quest completion streaks
- **Streak rewards**: Extra XP bonus for maintaining streaks
  - Daily streak: +10% XP bonus per day (max +100% at 10 days)
  - Weekly streak: +25% XP bonus per week (max +200% at 8 weeks)
  - Combined bonus: Daily + Weekly streak bonuses stack
- **Streak display**: Show current streaks and best streaks in user profile
- **Streak recovery**: Grace period for missed days (e.g., 1 day grace for daily streaks)

#### Quest Difficulty & XP Calculation
- **Difficulty impact**: Affects both base XP and completion time bonus
- **Base XP by difficulty**:
  - Easy: 50 XP base
  - Medium: 75 XP base  
  - Hard: 100 XP base
- **Completion time bonus**:
  - Early completion: +25% XP (completed 25%+ before deadline)
  - On-time completion: +0% XP (completed within deadline)
  - Late completion: -25% XP (completed after deadline)
- **Overachievement bonus**:
  - Perfect completion: +10% XP (completed exactly on deadline)
  - Overachievement: +15% XP (exceeded target by 25%+ for quantitative quests)
- **Difficulty calculation methods**:
  - **Linked quests**: Based on number of linked items (1-2=easy, 3-5=medium, 6+=hard)
  - **Quantitative quests**: Based on target count and time period (low count+long time=easy, high count+short time=hard)
  - **Deadline adjustment**: Large deadlines reduce difficulty (e.g., 30+ days = -1 difficulty level)
  - **User override**: Users can manually adjust difficulty (with XP impact warning)
  - **Auto-suggestion**: System suggests difficulty based on historical completion rates

#### Quest Sharing & Discovery
- **Privacy controls**: Users can set quest template sharing preferences
  - **Public**: Anyone can discover and use the quest template (with geographic restrictions)
  - **Followers**: Only users who follow the creator can see the template
  - **Private**: Quest template is not shared (default)
- **Sharing scope**: Only quest templates can be shared (not active quests)
- **Template discovery**: Users can browse and search public quest templates by category, difficulty, tags
- **Template usage**: Users can create quests from shared templates (creates as draft)
- **Geographic restrictions**: Template sharing respects data residency laws
- **Content moderation**: All public templates reviewed for inappropriate content
- **Attribution**: Original creator credited when using shared templates

#### Quest Challenges (System-Generated)
- **System challenges**: Pre-defined community challenges with shared quest templates
- **Challenge types**:
  - Weekly challenges (e.g., "Complete 5 tasks this week")
  - Monthly challenges (e.g., "Complete 3 goals this month")
  - Category challenges (e.g., "Health focus week")
  - Difficulty challenges (e.g., "Hard quest week")
- **Participation**: Users can join system challenges and create quests from challenge templates
- **Progress tracking**: Show individual progress within community challenge context
- **Rewards**: Bonus XP for participating in and completing system challenges
- **Note**: User-created challenges will be implemented as a separate feature (future enhancement)

#### Quest Leaderboards
- **Leaderboard types**: Both quest completion counts and XP earned
- **Privacy controls**: Users can opt-in/out of leaderboard participation
- **Leaderboard categories**:
  - Overall (all quests)
  - By category (Health, Work, Personal, etc.)
  - By time period (daily, weekly, monthly, all-time)
  - By difficulty (easy, medium, hard)
- **Display options**: Top 10, top 50, or personal ranking only
- **Privacy settings**: Users can choose to be anonymous on leaderboards

#### Quest Analytics & Insights
- **Completion analytics**:
  - Overall completion rate (by time period)
  - Completion rate by category and difficulty
  - Average completion time by quest type
  - Success rate trends over time
- **Performance insights**:
  - XP earned breakdown (base, bonuses, streaks)
  - Difficulty performance analysis
  - Category performance comparison
  - Time-based productivity patterns
- **Streak analysis**:
  - Current daily/weekly streaks
  - Best streak records
  - Streak recovery patterns
  - Streak impact on completion rates
- **Productivity patterns**:
  - Most productive times of day/week
  - Quest creation vs completion patterns
  - Template usage effectiveness
  - Challenge participation impact
- **Recommendations**:
  - Suggested quest difficulty based on history
  - Optimal quest timing recommendations
  - Category balance suggestions
  - Streak maintenance tips
- **Note**: AI-powered quest recommendations will be implemented as a separate premium feature (future enhancement)

#### Quest Data Retention
- **Active retention**: 90 days of quest data for real-time analytics
- **Archive strategy**: Data older than 90 days moved to low-cost storage (S3) with encryption
- **Analytics access**: Archived data available for historical trend analysis (anonymized)
- **User data export**: Users can export their complete quest history at any time (GDPR compliance)
- **Data deletion**: Users can request complete data deletion (GDPR "right to be forgotten")
- **Retention policy**: Consistent with user preferences and legal requirements
- **Cross-border compliance**: Data residency rules enforced based on user location

#### Quest Expiration & Grace Period
- **Grace period**: 72 hours after deadline before automatic expiration
- **Expiration notifications**: 
  - 24h after deadline: "Quest deadline passed - 48h remaining"
  - 48h after deadline: "Quest deadline passed - 24h remaining" 
  - 72h after deadline: "Quest expired and marked as failed"
- **Notification channels**: Uses user's preferred notification method (in-app, email, push)
- **Manual override**: Users can manually mark quest as failed before expiration
- **Expiration behavior**: Quest status changes from "active" to "failed" after 72h grace period

#### Quest Modification Rules
- **Allowed modifications**: Only deadline extension for active quests
- **Modification restrictions**: 
  - Title, description, difficulty, rewards, linked items cannot be changed after creation
  - Only deadline can be extended (not shortened)
- **Deadline extension penalty**:
  - Extension within 24h of deadline: -10% XP penalty
  - Extension within 48h of deadline: -20% XP penalty
  - Extension within 72h of deadline: -30% XP penalty
  - Extension beyond 72h: -50% XP penalty
- **Modification tracking**: System tracks all deadline extensions for analytics

#### Quest Conflict Detection
- **Conflict threshold**: Prevent quest creation if >25% overlap with existing active quests (reduced from 50%)
- **Conflict detection**:
  - Linked quests: Check for overlapping linked goals/tasks
  - Quantitative quests: Check for overlapping time periods and scope
  - Cross-quest conflicts: Check for conflicting quest dependencies
  - Time-based conflicts: Check for overlapping deadlines and active periods
- **User warnings**: 
  - Show conflict details when creating quests
  - Suggest alternatives (different time periods, different goals/tasks)
  - Require explicit confirmation to proceed with any conflict
- **Conflict resolution**: Users must modify quest parameters to eliminate conflicts before creation
- **Security**: Conflict detection runs server-side to prevent client-side bypassing

#### Quest Display & Actions
- **Status Indicators**: Visual status (active, completed, cancelled)
- **Progress Tracking**: 
  - Linked quests: Show completion status of linked items
  - Quantitative quests: Show progress bar with current/target count
- **Action Buttons**: 
  - Draft: Edit, Start quest, Delete
  - Active: Cancel quest, Mark as failed, view details
  - Completed/Cancelled/Failed: View details only
- **Admin Actions**: Delete quest (admin-only interface)

#### Quest Dashboard Features
- **Overview**: Quest statistics, recent activity, streak display
- **Analytics**: Completion rates, XP earned, productivity patterns
- **Quick Actions**: Create quest, join challenges, view leaderboards
- **Quest Management**: Filter, sort, and manage all quests
- **Integration**: Links to goal views for quests related to specific goals

### State Management

#### Quest State Structure
```typescript
interface QuestState {
  quests: Quest[];
  loading: boolean;
  error: string | null;
  filters: QuestFilters;
  selectedQuest: Quest | null;
  createForm: QuestCreateFormData;
  validationErrors: QuestValidationErrors;
}
```

#### Quest Hooks
- **useQuests**: Fetch and manage quest list
- **useQuestCreate**: Handle quest creation with validation (creates as draft)
- **useQuestStart**: Handle starting a draft quest (draft → active)
- **useQuestEdit**: Handle editing draft quests
- **useQuestCancel**: Handle quest cancellation (active → cancelled)
- **useQuestFail**: Handle marking quest as failed (active → failed)
- **useQuestDelete**: Handle quest deletion (admin)
- **useQuestProgress**: Track quest completion progress

### API Integration

#### GraphQL Operations (Reads)
```typescript
// Query user quests
const MY_QUESTS = gql`
  query MyQuests($goalId: ID) {
    myQuests(goalId: $goalId) {
      id
      title
      description
      difficulty
      rewardXp
      status
      tags
      deadline
      kind
      linkedGoalIds
      linkedTaskIds
      targetCount
      countScope
      startAt
      periodSeconds
      createdAt
      updatedAt
    }
  }
`;
```

#### REST API Operations (Writes)
```typescript
// Quest API service functions
export async function createQuest(payload: QuestCreatePayload): Promise<Quest> {
  const response = await authFetch('/quests/createQuest', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${token}`,
      'x-api-key': import.meta.env.VITE_API_GATEWAY_KEY || '',
    },
    body: JSON.stringify(payload)
  });
  return response.json();
}

export async function cancelQuest(questId: string): Promise<Quest> {
  const response = await authFetch(`/quests/quests/${questId}/cancel`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${token}`,
      'x-api-key': import.meta.env.VITE_API_GATEWAY_KEY || '',
    }
  });
  return response.json();
}

export async function failQuest(questId: string): Promise<Quest> {
  const response = await authFetch(`/quests/quests/${questId}/fail`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${token}`,
      'x-api-key': import.meta.env.VITE_API_GATEWAY_KEY || '',
    }
  });
  return response.json();
}

export async function deleteQuest(questId: string): Promise<boolean> {
  const response = await authFetch(`/quests/quests/${questId}`, {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${token}`,
      'x-api-key': import.meta.env.VITE_API_GATEWAY_KEY || '',
    }
  });
  return response.ok;
}
```

### Form Validation & UX

#### Quest Creation Validation
- **Title**: Required, min 3 characters, max 100 characters
- **Description**: Optional, max 500 characters
- **Category**: Required, must be one of predefined categories (Health, Work, Personal, Learning, Fitness, Creative, etc.)
- **Difficulty**: Required, must be "easy", "medium", or "hard"
- **Reward XP**: Optional, default 50, min 0, max 1000
- **Deadline**: Optional, must be future date
- **Linked Items**: For linked quests, at least one goal or task must be selected
- **Quantitative Fields**: For quantitative quests, targetCount > 0, valid startAt and periodSeconds

#### Error Handling & User Feedback
- **Field-level Validation**: Real-time validation with clear error messages
- **Form-level Validation**: Prevent submission with validation errors
- **Loading States**: Show loading indicators during API calls
- **Success Feedback**: Toast notifications for successful operations
- **Error Recovery**: Retry mechanisms for failed operations
- **Notification Display**: Toast notifications only (non-intrusive, temporary)
  - Quest created/started/completed/failed
  - Quest progress milestones
  - Quest deadline warnings
  - Streak achievements
  - Challenge participation updates

### Internationalization (i18n) - **MANDATORY REQUIREMENT**

#### Localization Project Pattern
- **Translation Module**: Single file `frontend/src/i18n/quest.ts` containing all languages
  - Exports `questTranslations: Record<Language, QuestTranslations>` with `en`, `es`, `fr`
  - Aligns with the existing single-file goal translations pattern
- **Aggregator**: Import and include `quest` in `frontend/src/i18n/translations.ts`
- **Translation Structure**: Nested object hierarchy for organized translations
- **Type Safety**: TypeScript interfaces for all translation objects
- **Fallback Strategy**: English as fallback for missing translations
- **Dynamic Loading**: Load translations based on user language preference

#### Translation Structure
```typescript
interface QuestTranslations {
  title: string;
  createQuest: {
    title: string;
    form: {
      basicInfo: {
        title: string;
        titleLabel: string;
        titlePlaceholder: string;
        descriptionLabel: string;
        descriptionPlaceholder: string;
        categoryLabel: string;
        categoryOptions: {
          health: string;
          work: string;
          personal: string;
          learning: string;
          fitness: string;
          creative: string;
        };
        difficultyLabel: string;
        difficultyOptions: {
          easy: string;
          medium: string;
          hard: string;
        };
        rewardXpLabel: string;
        deadlineLabel: string;
      };
      linking: {
        title: string;
        linkedGoalsLabel: string;
        linkedTasksLabel: string;
        selectGoalsPlaceholder: string;
        selectTasksPlaceholder: string;
        dependsOnQuestsLabel: string;
        selectQuestsPlaceholder: string;
      };
      quantitative: {
        title: string;
        targetCountLabel: string;
        countScopeLabel: string;
        countScopeOptions: {
          any: string;
          linked: string;
        };
        startAtLabel: string;
        periodLabel: string;
        periodUnit: string;
      };
    };
    validation: {
      titleRequired: string;
      titleMinLength: string;
      titleMaxLength: string;
      descriptionMaxLength: string;
      categoryRequired: string;
      difficultyRequired: string;
      rewardXpMin: string;
      rewardXpMax: string;
      deadlineFuture: string;
      linkedItemsRequired: string;
      targetCountRequired: string;
      targetCountMin: string;
      startAtRequired: string;
      periodRequired: string;
      periodMin: string;
    };
  };
  questList: {
    title: string;
    noQuests: string;
    filters: {
      all: string;
      draft: string;
      active: string;
      completed: string;
      cancelled: string;
      failed: string;
      difficulty: string;
      category: string;
      linkedGoals: string;
    };
    actions: {
      view: string;
      edit: string;
      start: string;
      cancel: string;
      fail: string;
      delete: string;
    };
  };
  questCard: {
    status: {
      draft: string;
      active: string;
      completed: string;
      cancelled: string;
      failed: string;
    };
    progress: {
      linked: string;
      quantitative: string;
    };
    difficulty: {
      easy: string;
      medium: string;
      hard: string;
    };
  };
  questDashboard: {
    title: string;
    overview: string;
    analytics: string;
    quickActions: string;
    recentActivity: string;
    streakDisplay: string;
  };
  questChallenges: {
    title: string;
    systemChallenges: string;
    joinChallenge: string;
    leaveChallenge: string;
    challengeProgress: string;
  };
  questLeaderboards: {
    title: string;
    completion: string;
    xpEarned: string;
    overall: string;
    byCategory: string;
    byTimePeriod: string;
    byDifficulty: string;
  };
  questAnalytics: {
    title: string;
    completionRate: string;
    averageTime: string;
    xpBreakdown: string;
    productivityPatterns: string;
    streakAnalysis: string;
  };
  questNotifications: {
    created: string;
    started: string;
    completed: string;
    failed: string;
    cancelled: string;
    deadlineApproaching: string;
    deadlinePassed: string;
    expired: string;
    streakAchieved: string;
    challengeJoined: string;
  };
  questTemplates: {
    title: string;
    browseTemplates: string;
    createFromTemplate: string;
    shareTemplate: string;
    privacySettings: string;
  };
  questModifications: {
    extendDeadline: string;
    deadlineExtensionPenalty: string;
    modificationTracking: string;
  };
  questConflicts: {
    conflictDetected: string;
    conflictDetails: string;
    suggestedAlternatives: string;
    proceedWithWarning: string;
  };
  messages: {
    createSuccess: string;
    startSuccess: string;
    editSuccess: string;
    cancelSuccess: string;
    failSuccess: string;
    deleteSuccess: string;
    createError: string;
    startError: string;
    editError: string;
    cancelError: string;
    failError: string;
    deleteError: string;
    conflictError: string;
    validationError: string;
  };
}
```

#### Localization Implementation Requirements
- **Translation Loading**: Use `useTranslation` hook for accessing translations
- **Language Detection**: Detect user language from browser/system preferences
- **Dynamic Updates**: Update UI when language changes without page reload
- **Missing Translation Handling**: Log missing keys and fallback to English
- **RTL Support**: Prepare for right-to-left languages (future enhancement)
- **Pluralization**: Handle singular/plural forms for different languages
- **Date/Time Formatting**: Use locale-specific date/time formats
- **Number Formatting**: Use locale-specific number formatting

### Accessibility Features

#### ARIA Implementation
- **Quest Forms**: Proper form labels, field descriptions, and error announcements
- **Quest Lists**: Screen reader friendly quest cards with status announcements
- **Progress Indicators**: Accessible progress bars with percentage announcements
- **Action Buttons**: Clear button labels and confirmation dialogs

#### Keyboard Navigation
- **Tab Order**: Logical tab sequence through quest forms and lists
- **Keyboard Shortcuts**: Quick actions for common operations
- **Focus Management**: Proper focus handling in modals and forms

### Performance Considerations

#### Data Loading
- **Lazy Loading**: Load quest details on demand
- **Pagination**: Implement pagination for large quest lists
- **Caching**: Cache quest data with appropriate invalidation
- **Optimistic Updates**: Update UI immediately for better UX

#### Component Optimization
- **Memoization**: Use React.memo for quest cards and forms
- **Debounced Validation**: Debounce form validation to reduce API calls
- **Virtual Scrolling**: For large quest lists (future enhancement)

#### Mobile Experience
- **Touch-friendly interface**: Large touch targets, swipe gestures for quest cards
- **Simplified navigation**: Bottom navigation bar for quest dashboard
- **Mobile-optimized forms**: Single-column layout, large input fields
- **Gesture support**: Swipe to complete/cancel quests, pull-to-refresh
- **Responsive design**: Adapts to different screen sizes while maintaining usability
- **Mobile quest creation**: Streamlined wizard optimized for mobile screens

---

## Security & Compliance Framework

### Security Controls

#### Authentication & Authorization
- **JWT Token Validation**: All requests must include valid, non-expired JWT tokens
- **Role-Based Access Control**: Admin operations require explicit admin role in JWT claims
- **Permission Verification**: Cross-user goal linking requires explicit permission grants
- **Token Refresh**: Automatic token refresh with secure storage
- **Session Management**: Proper session invalidation on logout/expiration

#### Input Validation & Sanitization
- **Server-Side Validation**: All inputs validated server-side with strict schemas
- **XSS Protection**: All text inputs sanitized against cross-site scripting
- **SQL Injection Prevention**: Parameterized queries and input validation
- **Rate Limiting**: 10 quest creations/hour, 100 operations/hour per user
- **Input Length Limits**: Enforced on all text fields (title: 100 chars, description: 500 chars)

#### Data Protection
- **Encryption at Rest**: All quest data encrypted in DynamoDB
- **Encryption in Transit**: HTTPS/TLS 1.3 for all API communications
- **Data Anonymization**: IP addresses and sensitive data anonymized in logs
- **Audit Trail**: Complete audit log of all quest operations
- **Data Minimization**: Only necessary data collected and stored

#### API Security
- **Security Headers**: Comprehensive security headers on all responses
- **CORS Configuration**: Restricted cross-origin resource sharing
- **Request Validation**: All API requests validated for structure and content
- **Error Handling**: Secure error messages without information disclosure
- **Request Tracing**: Unique request IDs for all operations

### Compliance Requirements

#### GDPR Compliance
- **Data Portability**: Users can export all quest data in machine-readable format
- **Right to Erasure**: Users can request complete data deletion
- **Consent Management**: Clear consent for data processing and sharing
- **Data Residency**: Quest data stored in user's geographic region
- **Privacy by Design**: Privacy controls built into quest creation flow

#### Data Retention
- **Consistent Policies**: Single data retention policy across all quest features
- **User Preferences**: Respect user archiving and deletion preferences
- **Legal Requirements**: Comply with applicable data protection laws
- **Automated Cleanup**: Automatic deletion of expired data
- **Audit Logging**: Complete audit trail for compliance reporting

#### Cross-Border Data Transfer
- **Geographic Restrictions**: Quest templates respect data residency laws
- **Transfer Safeguards**: Adequate protection for international data transfers
- **User Consent**: Explicit consent for cross-border data sharing
- **Data Localization**: Quest data stored in appropriate geographic regions

### Security Monitoring & Incident Response

#### Monitoring
- **Security Event Logging**: All security events logged and monitored
- **Anomaly Detection**: Unusual quest creation patterns flagged
- **Access Monitoring**: Track all quest access and modifications
- **Performance Monitoring**: API response times and error rates
- **Audit Trail Analysis**: Regular review of quest operation logs

#### Incident Response
- **Security Alerts**: Automated alerts for suspicious quest activities
- **Data Breach Response**: Procedures for handling potential data breaches
- **User Notification**: Timely notification of security incidents
- **Recovery Procedures**: Steps to restore service after security incidents
- **Forensic Analysis**: Tools and procedures for security investigation

---

## Quest Feature Rules & Requirements

### Quest Creation & Management Rules
- **Quest Creation Flow**: Multi-step wizard (Template → Basic Info → Type → Configuration → Preview)
- **Quest Templates**: Pre-defined templates + "start from scratch" option
- **Quest Duplication**: Not supported - users create quests from templates or scratch only
- **Quest Archiving**: User-controlled preferences (archive indefinitely, delete after 30/60/90/180 days, keep visible indefinitely, manual controls)

### Quest Linking & Relationships Rules
- **Quest Status Flow**: Draft (editable) → Active (immutable) → Completed/Cancelled/Failed
- **Cross-User Linking**: Goals can be linked if owner has permission AND users follow each other
- **Quest Dependencies**: Can only depend on own quests (quest chains within same user)
- **Task Linking**: Can only link to own tasks (tasks are always goal-owned)

### Quest Progress & Completion Rules
- **Completion Logic**: Automatic completion + manual "failed" marking only
- **Notifications**: User-configurable (in-app, email, push) with preference channels
- **Quest Streaks**: Both daily and weekly streaks with XP bonuses (daily +10% max +100%, weekly +25% max +200%)
- **Grace Period**: 72 hours after deadline before automatic expiration with notifications

### Quest Difficulty & Rewards Rules
- **Difficulty Impact**: Affects both base XP (easy=50, medium=75, hard=100) and completion time bonus
- **Completion Bonuses**: Early completion +25%, perfect completion +10%, overachievement +15%
- **Deadline Adjustment**: Large deadlines reduce difficulty (30+ days = -1 difficulty level)
- **Quest Categories**: One main category (Health, Work, Personal, Learning, Fitness, Creative) + tags for organization

### Quest Discovery & Sharing Rules
- **Privacy Controls**: Public, Followers, Private (default) for quest template sharing
- **Sharing Scope**: Only quest templates can be shared (not active quests)
- **System Challenges**: Pre-defined community challenges (user-created as separate feature)
- **Leaderboards**: Both completion and XP leaderboards with privacy controls (opt-in/out)

### Quest Analytics & Insights Rules
- **Analytics Scope**: Comprehensive analytics (completion rates, performance, streaks, patterns, recommendations)
- **AI Recommendations**: Premium feature (separate implementation)
- **Data Retention**: 90 days active + S3 archival for historical analysis

### Quest UI/UX Rules
- **Dashboard**: Both dedicated quest dashboard AND integration in goal views
- **Notifications**: Toast notifications only (non-intrusive, temporary)
- **Mobile Experience**: Mobile-optimized touch interface with gesture support

### Quest Business Logic Rules
- **Quest Expiration**: 72-hour grace period with notifications (24h, 48h, 72h warnings)
- **Quest Modifications**: Only deadline extension allowed for active quests with XP penalties
  - Within 24h: -10% XP, 48h: -20% XP, 72h: -30% XP, beyond 72h: -50% XP
- **Quest Conflicts**: Prevent creation if >50% overlap with existing active quests, warn user

### Localization Rules - **MANDATORY**
- **Translation Module**: Single file `frontend/src/i18n/quest.ts` providing `en`, `es`, `fr`
- **Type Safety**: TypeScript interfaces for all translation objects
- **Fallback Strategy**: English as fallback for missing translations
- **Dynamic Loading**: Load translations based on user language preference
- **Complete Coverage**: All UI text must be translatable

---

### Testing
Backend (pytest)
- Unit tests for create/cancel/delete handlers (validation, ownership, happy paths, boundary cases)
- Integration tests for listing quests by user (GSI1) and auto-completion scenarios

GraphQL
- Resolver tests for `myQuests` (reads)

API Gateway
- Define resources and methods for `/quests/createQuest`, `/quests/quests/{id}/cancel` (POST), `/quests/quests/{id}` (DELETE admin)
- Integrate with the Quest Service Lambda for write operations
- Configure Lambda Authorizer (existing) for JWT verification

Frontend (later)
- Contract tests for `apiQuest.ts` (mocks)
- Component tests for quest creation/edit flows (field validation, error states, loading)

---

### Infrastructure (Terraform/AppSync + API Gateway)
AppSync Schema
- Update `schema.graphql` with `Quest` type and `myQuests` query.

AppSync Data Source & Resolver
- DynamoDB data source for `myQuests` (VTL/JS resolver under `backend/infra/terraform2/resolvers/`)

API Gateway
- Define resources and methods for `/quests/createQuest`, `/quests/quests/{id}/cancel` (POST), `/quests/quests/{id}` (DELETE admin)
- Integrate with the Quest Service Lambda for write operations
- Configure Lambda Authorizer (existing) for JWT verification

IAM
- AppSync role: DDB read-only permissions for `myQuests`
- Quest Service Lambda execution role: DDB write (Put/Update/Delete) and read (Get/Query) permissions with least privilege
- **Security IAM Policies**:
  - CloudWatch Logs permissions for audit logging
  - KMS permissions for data encryption/decryption
  - Rate limiting service permissions
  - Cross-account permissions for goal linking verification
  - Admin role permissions for quest deletion operations

Security Configuration
- **API Gateway Security**:
  - WAF rules for rate limiting and DDoS protection
  - Security headers configuration
  - CORS policy with restricted origins
  - Request validation schemas
- **DynamoDB Security**:
  - Encryption at rest enabled
  - Point-in-time recovery enabled
  - Access logging enabled
  - VPC endpoints for private access
- **Lambda Security**:
  - VPC configuration for network isolation
  - Environment variables encrypted with KMS
  - Dead letter queues for error handling
  - Concurrency limits to prevent resource exhaustion

No new DynamoDB indexes required in this slice.

---

### Acceptance Criteria (ALL must be met)
- Reads are served by AppSync DDB resolvers; writes are handled by API Gateway → Quest Service Lambda
- User can create a Quest (linked/quantitative) and receives persisted Quest with IDs and timestamps
- Quests are immutable after creation; user can only cancel; delete is admin-only
- Automatic completion is applied:
  - Linked quests succeed when all linked items are complete (pre-start completions count)
  - Quantitative quests succeed when targetCount is met within [startAt, startAt+periodSeconds], per countScope
- Listing `myQuests(goalId)` returns quests with correct fields; ownership enforced
- Strict validations enforced; clear error messages on failures; structured logs present
- **MANDATORY**: Complete localization support for all Quest features
  - All UI text must be translatable (English, Spanish, French)
  - Translation files must be complete and type-safe
  - Language switching must work without page reload
  - Fallback to English for missing translations
- **MANDATORY**: Security and compliance requirements met
  - All inputs validated and sanitized server-side
  - Rate limiting enforced (10 creations/hour, 100 operations/hour per user)
  - Cross-user goal linking requires explicit permission verification
  - JWT token validation and role-based access control implemented
  - Audit trail logging for all quest operations
  - XSS and injection attack protection implemented
  - GDPR compliance features (data export, deletion, consent management)
  - Data encryption at rest and in transit
  - Security headers and CORS properly configured
- Unit and integration tests passing; static/type checks pass; security scans show no high/critical
- Documentation updated (this feature doc, schema references); no regressions in progress/milestones

---

## Junior Developer Task List

### **Phase 1: Backend Foundation (Days 1-5)**

#### **Day 1: Data Models & Schema**
- [x] **Task 1.1**: Create Pydantic models in `backend/services/quest-service/app/models/quest.py` ✅ **COMPLETED**
  - `QuestCreatePayload`, `QuestUpdatePayload`, `QuestCancelPayload`, `QuestResponse`
  - Include all fields: title, description, category, difficulty, rewardXp, status, tags, privacy, etc.
  - Add validation rules and field constraints
  - **Deliverable**: Complete model definitions with validation

#### **Day 2: GraphQL Schema Updates**
- [x] **Task 1.2**: Update `backend/infra/terraform2/graphql/schema.graphql` ✅ **COMPLETED**
  - Add `Quest` type with all fields
  - Add `QuestStatus`, `QuestKind`, `QuestCountScope` enums
  - Add `myQuests` query
  - **Deliverable**: Updated GraphQL schema file
  - **Status**: ✅ **COMPLETED** - Schema updated with all Quest types and queries

#### **Day 3: DynamoDB Integration**
- [x] **Task 1.3**: Create DynamoDB helper functions in `backend/services/quest-service/app/db/quest_db.py` ✅ **COMPLETED**
  - `create_quest()`, `get_quest()`, `update_quest()`, `delete_quest()`, `list_user_quests()`
  - Implement proper error handling and retry logic
  - **Deliverable**: Complete database operations module
  - **Status**: ✅ **COMPLETED** - 84% test coverage, all tests passing

---

## ✅ **Phase 1 Progress Summary**

### **Completed Tasks (3/5):**

#### **✅ Task 1.1 - Pydantic Models** 
- **Status**: COMPLETED
- **Coverage**: 91% test coverage
- **Files**: `app/models/quest.py`, `app/models/__init__.py`
- **Features**: Complete validation, XSS protection, comprehensive field validation

#### **✅ Task 1.2 - GraphQL Schema Updates**
- **Status**: COMPLETED  
- **Files**: `backend/infra/terraform2/graphql/schema.graphql`
- **Features**: Quest types, enums, myQuests query, full schema integration

#### **✅ Task 1.3 - DynamoDB Integration**
- **Status**: COMPLETED
- **Coverage**: 84% test coverage, 119 tests passing
- **Files**: `app/db/quest_db.py`, `app/db/__init__.py`
- **Features**: Complete CRUD operations, error handling, audit trail, optimistic locking

### **Remaining Tasks (2/5):**

#### **⏳ Task 1.4 - Quest Service Endpoints** (Next)
- **Status**: PENDING
- **Target**: REST API endpoints in `main.py`
- **Dependencies**: Tasks 1.1, 1.2, 1.3 ✅

#### **⏳ Task 1.5 - Backend Testing & Security**
- **Status**: PENDING  
- **Target**: Comprehensive testing and security validation
- **Dependencies**: Tasks 1.1-1.4

---

#### **Day 4: Quest Service Endpoints**
- [x] **Task 1.4**: Implement REST endpoints in `backend/services/quest-service/app/main.py` ✅ **COMPLETED**
  - `POST /quests/createQuest` (creates as draft)
  - `POST /quests/quests/{id}/start` (draft → active)
  - `PUT /quests/quests/{id}` (edit draft only)
  - `POST /quests/quests/{id}/cancel` (active → cancelled)
  - `POST /quests/quests/{id}/fail` (active → failed)
  - `DELETE /quests/quests/{id}` (admin-only)
  - **Deliverable**: Complete API endpoints with proper validation
  - **Status**: ✅ **COMPLETED** - All 6 REST endpoints implemented with comprehensive error handling, authentication, and validation

#### **Day 5: Backend Testing & Security**
- [ ] **Task 1.5**: Write unit tests in `backend/services/quest-service/tests/test_quest.py`
  - Test all Pydantic models
  - Test all database operations
  - Test all API endpoints
  - Test validation rules and error cases
  - Test security controls (rate limiting, input sanitization, authorization)
  - Test XSS and injection attack prevention
  - **Deliverable**: Complete test suite with >90% coverage including security tests

### **Phase 2: Frontend Models & API (Days 6-8)**

#### **Day 6: TypeScript Models**
- [ ] **Task 2.1**: Create `frontend/src/models/quest.ts`
  - Define `Quest`, `QuestCreatePayload`, `QuestUpdatePayload` interfaces
  - Add validation schemas using Zod
  - Include all quest statuses, categories, and types
  - **Deliverable**: Complete TypeScript model definitions

#### **Day 7: API Service Layer**
- [ ] **Task 2.2**: Implement `frontend/src/lib/apiQuest.ts`
  - GraphQL operations: `myQuests` query
  - REST operations: `createQuest`, `startQuest`, `editQuest`, `cancelQuest`, `failQuest`, `deleteQuest`
  - Proper error handling and authentication headers
  - **Deliverable**: Complete API service functions

#### **Day 8: Custom Hooks**
- [ ] **Task 2.3**: Create custom hooks in `frontend/src/hooks/useQuest.ts`
  - `useQuests`, `useQuestCreate`, `useQuestStart`, `useQuestEdit`, `useQuestCancel`, `useQuestFail`, `useQuestDelete`
  - Include loading states, error handling, and optimistic updates
  - **Deliverable**: Complete custom hooks with proper state management

### **Phase 3: Localization (Days 9-11)**

#### **Day 9: English Translations**
- [ ] **Task 3.1**: Create `frontend/src/i18n/quest/en.ts`
  - Complete English translation file with all Quest-related text
  - Include form labels, validation messages, status text, actions
  - Follow the `QuestTranslations` interface structure
  - **Deliverable**: Complete English translation file

#### **Day 10: Spanish Translations**
- [ ] **Task 3.2**: Create `frontend/src/i18n/quest/es.ts`
  - Translate all English text to Spanish
  - Maintain consistency with existing Spanish translations
  - Test with Spanish-speaking users if possible
  - **Deliverable**: Complete Spanish translation file

#### **Day 11: French Translations**
- [ ] **Task 3.3**: Create `frontend/src/i18n/quest/fr.ts`
  - Translate all English text to French
  - Maintain consistency with existing French translations
  - Test with French-speaking users if possible
  - **Deliverable**: Complete French translation file

### **Phase 4: Core UI Components (Days 12-16)**

#### **Day 12: Quest Card Component**
- [ ] **Task 4.1**: Create `frontend/src/components/quest/QuestCard.tsx`
  - Display quest information (title, status, progress, difficulty)
  - Show action buttons based on quest status
  - Implement proper accessibility features
  - **Deliverable**: Complete QuestCard component with all statuses

#### **Day 13: Quest List Component**
- [ ] **Task 4.2**: Create `frontend/src/components/quest/QuestList.tsx`
  - Display list of quests with filtering and sorting
  - Implement pagination for large lists
  - Add loading states and empty states
  - **Deliverable**: Complete QuestList component with filtering

#### **Day 14: Quest Creation Form - Basic Info**
- [ ] **Task 4.3**: Create `frontend/src/components/quest/QuestCreateForm.tsx` (Step 1)
  - Basic information form (title, description, category, difficulty, reward XP, deadline)
  - Real-time validation with error messages
  - Template selection (Step 0)
  - **Deliverable**: Complete basic info form with validation

#### **Day 15: Quest Creation Form - Configuration**
- [ ] **Task 4.4**: Complete `QuestCreateForm.tsx` (Steps 2-4)
  - Quest type selection (linked vs quantitative)
  - Quest configuration (linking goals/tasks or setting quantitative parameters)
  - Preview and confirmation step
  - **Deliverable**: Complete multi-step quest creation wizard

#### **Day 16: Quest Details Component**
- [ ] **Task 4.5**: Create `frontend/src/components/quest/QuestDetails.tsx`
  - Detailed view of quest with all information
  - Progress tracking for linked and quantitative quests
  - Action buttons based on quest status
  - **Deliverable**: Complete quest details view

### **Phase 5: Dashboard & Integration (Days 17-19)**

#### **Day 17: Quest Dashboard**
- [ ] **Task 5.1**: Create `frontend/src/pages/QuestDashboard.tsx`
  - Quest overview with statistics
  - Recent activity display
  - Quick actions (create quest, join challenges)
  - **Deliverable**: Complete quest dashboard page

#### **Day 18: Goal Integration**
- [ ] **Task 5.2**: Integrate quests into goal views
  - Add quest section to goal detail pages
  - Show quests related to specific goals
  - Allow creating quests from goal context
  - **Deliverable**: Quest integration in goal views

#### **Day 19: Quest Filters & Search**
- [ ] **Task 5.3**: Create `frontend/src/components/quest/QuestFilters.tsx`
  - Filter by status, difficulty, category, linked goals
  - Search functionality
  - Sort options (date, difficulty, progress)
  - **Deliverable**: Complete filtering and search functionality

### **Phase 6: Advanced Features (Days 20-23)**

#### **Day 20: Quest Progress Visualization**
- [ ] **Task 6.1**: Create `frontend/src/components/quest/QuestProgress.tsx`
  - Progress bars for quantitative quests
  - Completion status for linked quests
  - Streak display and XP tracking
  - **Deliverable**: Complete progress visualization components

#### **Day 21: Quest Notifications**
- [ ] **Task 6.2**: Implement quest notification system
  - Toast notifications for quest events
  - Notification preferences integration
  - Real-time updates for quest status changes
  - **Deliverable**: Complete notification system

#### **Day 22: Quest Templates & Sharing**
- [ ] **Task 6.3**: Create quest template functionality
  - Browse and search public quest templates
  - Create quests from templates
  - Quest template sharing with privacy controls
  - **Deliverable**: Complete template system

#### **Day 23: Quest Analytics**
- [ ] **Task 6.4**: Create `frontend/src/components/quest/QuestAnalytics.tsx`
  - Completion rate analytics
  - XP earned breakdown
  - Productivity patterns
  - Streak analysis
  - **Deliverable**: Complete analytics dashboard

### **Phase 7: Testing & Polish (Days 24-26)**

#### **Day 24: Component Testing**
- [ ] **Task 7.1**: Write component tests for all Quest components
  - Unit tests for individual components
  - Integration tests for quest flows
  - Accessibility testing
  - **Deliverable**: Complete component test suite

#### **Day 25: E2E Testing**
- [ ] **Task 7.2**: Create end-to-end tests for quest functionality
  - Quest creation flow
  - Quest management operations
  - Quest completion scenarios
  - **Deliverable**: Complete E2E test suite

#### **Day 26: Mobile Optimization & Polish**
- [ ] **Task 7.3**: Mobile optimization and final polish
  - Touch-friendly interface improvements
  - Mobile-specific gesture support
  - Performance optimization
  - Final bug fixes and UI polish
  - **Deliverable**: Mobile-optimized quest features

### **Phase 8: Security Implementation (Days 27-29)**

#### **Day 27: Security Controls Implementation**
- [ ] **Task 8.1**: Implement security controls
  - Add input sanitization and XSS protection
  - Implement rate limiting middleware
  - Add JWT token validation and role verification
  - Implement cross-user permission verification
  - **Deliverable**: Complete security controls implementation

#### **Day 28: Compliance Features**
- [ ] **Task 8.2**: Implement compliance features
  - Add GDPR data export functionality
  - Implement data deletion (right to erasure)
  - Add consent management for data sharing
  - Implement audit trail logging
  - **Deliverable**: Complete compliance features

#### **Day 29: Security Testing**
- [ ] **Task 8.3**: Security testing and validation
  - Penetration testing for quest endpoints
  - Security vulnerability scanning
  - GDPR compliance validation
  - Security audit trail verification
  - **Deliverable**: Security testing completed and validated

### **Phase 9: Infrastructure & Deployment (Days 30-31)**

#### **Day 30: Infrastructure Updates**
- [ ] **Task 9.1**: Update Terraform configuration
  - Add API Gateway routes for quest endpoints
  - Update AppSync schema and resolvers
  - Configure IAM permissions and security policies
  - Add WAF rules and security headers
  - **Deliverable**: Complete infrastructure configuration with security

#### **Day 31: Documentation & Deployment**
- [ ] **Task 9.2**: Final documentation and deployment
  - Update API documentation with security details
  - Create user guides for quest features
  - Deploy and test in staging environment
  - Security review and final validation
  - **Deliverable**: Complete documentation and deployed features

---

## Definition of Done Checklist

### **Backend Implementation**
- [ ] **Data Models**: All Pydantic models created with proper validation
- [ ] **Database Operations**: CRUD operations implemented with error handling
- [x] **API Endpoints**: All REST endpoints functional with proper authentication ✅ **COMPLETED**
- [ ] **GraphQL Schema**: Quest types and queries added to AppSync schema
- [ ] **Unit Tests**: >90% test coverage for all backend code
- [ ] **Integration Tests**: API endpoints tested with real DynamoDB
- [ ] **Error Handling**: Comprehensive error handling and logging implemented
- [ ] **Validation**: Input validation for all quest operations
- [ ] **Authorization**: Proper user ownership and permission checks

### **Frontend Implementation**
- [ ] **TypeScript Models**: Complete type definitions for all quest entities
- [ ] **API Integration**: GraphQL queries and REST API calls implemented
- [ ] **Custom Hooks**: All quest management hooks with proper state management
- [ ] **UI Components**: All quest components (cards, forms, lists, details) created
- [ ] **Form Validation**: Real-time validation with error messages
- [ ] **Loading States**: Proper loading indicators for all async operations
- [ ] **Error Handling**: User-friendly error messages and recovery options
- [ ] **Responsive Design**: Mobile-optimized interface for all screen sizes
- [ ] **Accessibility**: ARIA labels, keyboard navigation, screen reader support

### **Localization (MANDATORY)**
- [ ] **English Translations**: Complete English translation file (en.ts)
- [ ] **Spanish Translations**: Complete Spanish translation file (es.ts)
- [ ] **French Translations**: Complete French translation file (fr.ts)
- [ ] **Type Safety**: TypeScript interfaces for all translation objects
- [ ] **Dynamic Loading**: Language switching functionality implemented
- [ ] **Fallback Strategy**: English fallback for missing translations
- [ ] **RTL Support**: Right-to-left language support if needed
- [ ] **Locale Formatting**: Date, time, and number formatting per locale

### **Quest Features**
- [ ] **Quest Creation**: Multi-step wizard with template selection
- [ ] **Quest Management**: Draft, start, edit, cancel, fail, delete operations
- [ ] **Quest Linking**: Link to goals and tasks with validation
- [ ] **Quest Types**: Both linked and quantitative quest types supported
- [ ] **Quest Progress**: Real-time progress tracking and visualization
- [ ] **Quest Completion**: Automatic completion logic implemented
- [ ] **Quest Streaks**: Daily and weekly streak tracking with XP bonuses
- [ ] **Quest Categories**: Category selection and tag organization
- [ ] **Quest Templates**: Pre-defined templates and custom creation
- [ ] **Quest Sharing**: Template sharing with privacy controls

### **Advanced Features**
- [ ] **Quest Analytics**: Completion rates, performance metrics, streak analysis
- [ ] **Quest Notifications**: Toast notifications for quest events
- [ ] **Quest Filters**: Filter by status, difficulty, category, linked items
- [ ] **Quest Search**: Search functionality for quest titles and descriptions
- [ ] **Quest Dashboard**: Dedicated quest overview page
- [ ] **Goal Integration**: Quest section in goal detail views
- [ ] **Quest Conflicts**: Overlap detection and user warnings
- [ ] **Quest Expiration**: 72-hour grace period with notifications
- [ ] **Quest Modifications**: Deadline extension with XP penalties

### **Testing & Quality**
- [ ] **Unit Tests**: All components and functions have unit tests
- [ ] **Integration Tests**: API integration tests passing
- [ ] **E2E Tests**: Complete user journey tests (create, manage, complete quest)
- [ ] **Accessibility Tests**: Screen reader and keyboard navigation tests
- [ ] **Performance Tests**: Load testing for quest operations
- [ ] **Cross-Browser Tests**: Chrome, Firefox, Safari, Edge compatibility
- [ ] **Mobile Tests**: iOS and Android device testing
- [ ] **Error Scenarios**: Network failures, validation errors, edge cases tested

### **Infrastructure & Deployment**
- [ ] **Terraform Updates**: Infrastructure code updated for quest features
- [ ] **API Gateway**: Quest endpoints configured and deployed
- [ ] **AppSync**: GraphQL schema and resolvers updated
- [ ] **DynamoDB**: Quest table structure and indexes created
- [ ] **IAM Permissions**: Proper permissions for quest operations
- [ ] **Environment Variables**: All required environment variables configured
- [ ] **Monitoring**: CloudWatch logs and metrics configured
- [ ] **Staging Deployment**: Features deployed and tested in staging

### **Documentation & User Experience**
- [ ] **API Documentation**: Quest API endpoints documented
- [ ] **User Guides**: Quest creation and management guides created
- [ ] **Developer Documentation**: Implementation details and patterns documented
- [ ] **Error Messages**: All error messages are user-friendly and actionable
- [ ] **Loading Messages**: Clear loading states and progress indicators
- [ ] **Success Messages**: Confirmation messages for all quest operations
- [ ] **Help Text**: Contextual help and tooltips where needed
- [ ] **Onboarding**: Quest feature introduction for new users

### **Performance & Optimization**
- [ ] **Bundle Size**: Quest features don't significantly increase bundle size
- [ ] **API Response Times**: Quest operations complete within acceptable time
- [ ] **Database Queries**: Optimized queries with proper indexing
- [ ] **Caching**: Appropriate caching for quest data
- [ ] **Lazy Loading**: Quest components loaded on demand
- [ ] **Image Optimization**: Any quest-related images optimized
- [ ] **Code Splitting**: Quest code properly split for optimal loading

### **Security & Compliance**
- [ ] **Input Sanitization**: All user inputs properly sanitized and XSS-protected
- [ ] **Authentication**: Proper user authentication for all quest operations with JWT validation
- [ ] **Authorization**: Users can only access their own quests with role-based access control
- [ ] **Data Validation**: Server-side validation for all quest data with strict schemas
- [ ] **XSS Protection**: Cross-site scripting protection implemented
- [ ] **CSRF Protection**: Cross-site request forgery protection
- [ ] **Data Privacy**: Quest data handling complies with privacy requirements
- [ ] **Rate Limiting**: 10 quest creations/hour, 100 operations/hour per user enforced
- [ ] **Cross-User Security**: Explicit permission verification for goal linking
- [ ] **Audit Logging**: Complete audit trail for all quest operations
- [ ] **GDPR Compliance**: Data export, deletion, and consent management implemented
- [ ] **Data Encryption**: Encryption at rest and in transit implemented
- [ ] **Security Headers**: Comprehensive security headers configured
- [ ] **Penetration Testing**: Security testing completed with no high/critical vulnerabilities

### **Final Verification**
- [ ] **Feature Complete**: All specified quest features implemented
- [ ] **Bug Free**: No critical or high-priority bugs remaining
- [ ] **User Acceptance**: Quest features meet user requirements
- [ ] **Performance Acceptable**: Quest operations perform within SLA
- [ ] **Accessibility Compliant**: Meets WCAG 2.1 AA standards
- [ ] **Mobile Ready**: Quest features work on mobile devices
- [ ] **Production Ready**: Code is ready for production deployment
- [ ] **Documentation Complete**: All documentation is up to date

### **Sign-off Requirements**
- [ ] **Code Review**: All code reviewed and approved by senior developer
- [ ] **QA Testing**: Quality assurance testing completed and passed
- [ ] **Product Owner**: Product owner approval for feature completeness
- [ ] **UX Review**: User experience review completed and approved
- [ ] **Security Review**: Security review completed and approved
- [ ] **Performance Review**: Performance review completed and approved
- [ ] **Accessibility Review**: Accessibility review completed and approved
- [ ] **Final Approval**: All stakeholders have approved the implementation

---

**Note**: This checklist must be completed in full before the Quest feature can be considered "Done" and ready for production release. Each item should be verified by the appropriate team member and documented with evidence (test results, screenshots, etc.).

---

### **Task Completion Guidelines**

#### **Daily Task Requirements:**
- Each task must be completed within 8 hours
- All code must be properly tested
- All changes must be reviewed by senior developer
- Documentation must be updated for each task

#### **Quality Standards:**
- Follow existing code patterns and conventions
- Implement proper error handling
- Include accessibility features
- Ensure mobile responsiveness
- Maintain type safety throughout

#### **Dependencies:**
- Tasks must be completed in order
- Each phase depends on the previous phase
- Backend tasks must be completed before frontend integration
- Localization must be completed before UI components

#### **Success Criteria:**
- All tests passing
- No linting errors
- Accessibility compliance
- Mobile responsiveness
- Complete localization support
- Performance requirements met

---

### Implementation Notes
- Quest operations use Quest Service Lambda for complex business logic and validation
- AppSync VTL resolvers used only for simple reads (myQuests query)
- Direct DynamoDB access from Quest Service Lambda for all write operations
- Keep validation/business rules server-side; frontend mirrors for UX only
- Avoid introducing new GSIs until access patterns justify them
- Follow existing patterns for logging (`log_event` wrappers) and error propagation
- **MANDATORY**: All Quest features must implement complete localization support
  - Use `useTranslation` hook for all user-facing text
  - Implement proper TypeScript interfaces for translation objects
  - Ensure all error messages, notifications, and UI text are translatable
  - Test language switching functionality thoroughly


