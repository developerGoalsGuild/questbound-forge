# 13.1 TasksModal API Key Fix

## Issue
The TasksModal was getting a 403 Forbidden error when trying to update tasks:

```
PUT http://localhost:8080/v1/quests/tasks/030d0886-fe47-4971-bb86-4d14c7b1ef5f 403 (Forbidden)
```

## Root Cause
The `updateTask` function in `apiTask.ts` was missing the `x-api-key` header that's required for API Gateway authentication. The `deleteTask` function had this header, but `createTask` and `updateTask` were missing it.

## Solution Applied

### 1. Added Missing API Key Header to createTask
**Before:**
```typescript
const response = await fetch(url, {                                         
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: `Bearer ${token}`,
  },
  body: JSON.stringify(input),
});
```

**After:**
```typescript
const response = await fetch(url, {                                         
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: `Bearer ${token}`,
    'x-api-key': import.meta.env.VITE_API_GATEWAY_KEY || '',
  },
  body: JSON.stringify(input),
});
```

### 2. Added Missing API Key Header to updateTask
**Before:**
```typescript
const response = await fetch(url, {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
    Authorization: `Bearer ${token}`,
  },
  body: JSON.stringify(updates),
});
```

**After:**
```typescript
const response = await fetch(url, {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
    Authorization: `Bearer ${token}`,
    'x-api-key': import.meta.env.VITE_API_GATEWAY_KEY || '',
  },
  body: JSON.stringify(updates),
});
```

## Files Modified
- `frontend/src/lib/apiTask.ts` - Added `x-api-key` header to both `createTask` and `updateTask` functions

## API Gateway Authentication Pattern
The codebase follows this pattern for API Gateway authentication:
- âœ… **Authorization header**: `Bearer ${token}` for user authentication
- âœ… **x-api-key header**: `import.meta.env.VITE_API_GATEWAY_KEY` for API Gateway authentication
- âœ… **Content-Type header**: `application/json` for request body type

## Consistency Check
All task-related API functions now have consistent headers:
- âœ… `createTask` - Has both Authorization and x-api-key
- âœ… `updateTask` - Has both Authorization and x-api-key  
- âœ… `deleteTask` - Already had both Authorization and x-api-key
- âœ… `loadTasks` - Uses GraphQL (different authentication pattern)

## Result
- âœ… No more 403 Forbidden errors when updating tasks
- âœ… Task updates should work properly
- âœ… Consistent authentication across all task API calls
- âœ… Better error handling and user experience

## Testing
1. **Open TasksModal** - Should load without errors
2. **Click Edit Task** - Should enter edit mode
3. **Make changes and save** - Should update successfully without 403 error
4. **Check console** - Should not see Forbidden errors
5. **Verify task updated** - Changes should be reflected in the UI

The TasksModal should now work properly for updating tasks! ðŸš€
