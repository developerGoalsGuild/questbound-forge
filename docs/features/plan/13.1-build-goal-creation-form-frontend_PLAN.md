# 13.1 – Build goal creation form (frontend) - Feature Plan

## Overview
Restructure the goals functionality into separate, focused pages following the project's architectural patterns:

1. **Goals.tsx** - Goal editing page with task management (remove goal list, add task modal button)
2. **GoalsList.tsx** - Goals listing page with edit/delete actions
3. **GoalCreationForm.tsx** - Dedicated goal creation form component
4. **Dashboard Integration** - Add goals button to dashboard for easy access

This separation provides better user experience with focused functionality on each page, following the project's established patterns for form components, validation, accessibility features, and responsive design.

## Dependencies
- 11.2 (presumed goal management backend infrastructure)
- Existing `Goals.tsx` component with goal creation and task management functionality
- `useTranslation` hook with goal translations
- `apiGoal.ts` service with goal CRUD functions
- `apiTask.ts` service with task management functions
- Quest-service backend with goal and task endpoints
- DynamoDB single-table goal and task storage pattern

## Technical Implementation

### Frontend Components

#### 1. Goal Models (`frontend/src/models/goal.ts`)
- **Location**: `frontend/src/models/goal.ts`
- **Purpose**: TypeScript interfaces and types for goal-related data
- **Contents**:
  - `GoalFormData` interface for form state
  - `GoalValidationErrors` interface for form errors
  - `NLPQuestion` interface for well-formed outcome questions
  - `GoalCategory` interface for goal categorization
  - `GoalStatus` enum for goal states
  - `GoalListItem` interface for goals list display

#### 2. Goal Validation Schema (`frontend/src/lib/validation/goalValidation.ts`)
- **Location**: `frontend/src/lib/validation/goalValidation.ts`
- **Purpose**: Zod validation schemas specific to goal forms
- **Schemas**:
  - `goalCreateSchema`: Main validation schema for goal creation
  - `goalUpdateSchema`: Validation schema for goal updates
  - `titleSchema`: Title validation with length and content requirements
  - `deadlineSchema`: Date validation with business rules and future date checks
  - `nlpAnswerSchema`: Validation for individual NLP question answers
  - `categorySchema`: Category validation against allowed values
- **Localization**: Error messages use translation keys for i18n support

#### 3. Goal Translation Files (`frontend/src/i18n/goal*.ts`)
- **Location**: `frontend/src/i18n/goal*.ts` (separate files per component)
- **Purpose**: i18n translations following project pattern with separate translation models per screen/component
- **Files**:
  - `goalList.ts`: Translations for GoalsList page
  - `goalEdit.ts`: Translations for Goals edit page
  - `goalCreation.ts`: Translations for GoalCreationForm component
  - `goalActions.ts`: Translations for GoalActions component
  - `goalDashboard.ts`: Translations for Dashboard goals button
- **Languages**: English (en), Spanish (es), French (fr)
- **Structure**: TypeScript interfaces with nested object structure following project pattern

#### 4. Goals List Page (`frontend/src/pages/goals/GoalsList.tsx`)
- **Location**: `frontend/src/pages/goals/GoalsList.tsx`
- **Purpose**: Main goals listing page with edit/delete actions
- **Features**:
  - Display all user goals in a responsive table/card layout
  - Search and filter functionality
  - Status filtering (active, paused, completed, archived)
  - Edit goal action (navigate to Goals.tsx with goal ID)
  - Delete goal action with confirmation dialog
  - "Create New Goal" button (navigate to goal creation form)
  - Pagination for large goal lists

#### 5. Goals Edit Page (`frontend/src/pages/goals/Goals.tsx` - Refactored)
- **Location**: `frontend/src/pages/goals/Goals.tsx`
- **Purpose**: Goal editing page with task management
- **Features**:
  - Display selected goal details for editing
  - Task list management using existing TasksModal component
  - "View Tasks" button to open existing TasksModal
  - Goal update form with validation
  - "Create New Goal" button (navigate to creation form)
  - "Back to Goals List" navigation
  - Real-time task updates
  - **Removed**: Goal list functionality (moved to GoalsList.tsx)

#### 6. Goal Creation Form Component (`frontend/src/components/forms/GoalCreationForm.tsx`)
- **Location**: `frontend/src/components/forms/GoalCreationForm.tsx`
- **Purpose**: Dedicated goal creation form component with comprehensive validation
- **Dependencies**:
  - `useTranslation` hook for i18n support
  - React Hook Form with Zod validation
  - Shadcn/UI form components (Input, Textarea, Button, Card, Select)
  - Tailwind CSS for responsive layout
  - Custom `apiGoal` service for API calls

#### 7. NLP Questions Component (`frontend/src/components/forms/NLPQuestionsSection.tsx`)
- **Location**: `frontend/src/components/forms/NLPQuestionsSection.tsx`
- **Purpose**: Reusable component for well-formed outcome questions
- **Features**:
  - Dynamic question rendering based on `nlpQuestionOrder`
  - Individual field validation and error display
  - Accessibility features with proper labels and hints
  - Responsive layout for mobile and desktop

#### 8. Goal Category Selector (`frontend/src/components/forms/GoalCategorySelector.tsx`)
- **Location**: `frontend/src/components/forms/GoalCategorySelector.tsx`
- **Purpose**: Category selection component with predefined options
- **Features**:
  - Dropdown/select interface for category selection
  - Custom category input option
  - Validation for category selection
  - i18n support for category labels

#### 9. Goal Actions Component (`frontend/src/components/goals/GoalActions.tsx`)
- **Location**: `frontend/src/components/goals/GoalActions.tsx`
- **Purpose**: Reusable component for goal action buttons
- **Features**:
  - Edit goal button
  - Delete goal button with confirmation
  - Status change actions
  - Consistent styling and behavior

#### 10. Dashboard Goals Button (`frontend/src/components/dashboard/GoalsButton.tsx`)
- **Location**: `frontend/src/components/dashboard/GoalsButton.tsx`
- **Purpose**: Dashboard button for quick access to goals
- **Features**:
  - Quick access button to goals list
  - Display active goals count
  - Responsive design for dashboard layout
  - Integration with existing dashboard components

### API Integration

#### 1. Enhanced Goal API Service (`frontend/src/lib/apiGoal.ts`)
- **Existing Functions**: Already implemented
  - `createGoal(input: GoalInput): Promise<GoalResponse>`
  - `loadGoals(): Promise<Goal[]>`
  - `getActiveGoalsCountForUser(userId: string): Promise<number>`
- **New Functions**:
  - `updateGoal(goalId: string, updates: GoalUpdateInput): Promise<GoalResponse>`: Update existing goal
  - `deleteGoal(goalId: string): Promise<void>`: Delete goal
  - `getGoal(goalId: string): Promise<GoalResponse>`: Get single goal details
  - `validateGoalTitle(title: string): Promise<boolean>`: Real-time title validation
  - `getGoalCategories(): Promise<string[]>`: Fetch available categories
  - `validateGoalDeadline(deadline: string): Promise<boolean>`: Deadline validation

#### 2. Form Data Transformation
- **API Mapping**: Convert between form format and API format
- **NLP Answers**: Transform form answers to API-compatible format
- **Date Handling**: Convert date inputs to epoch seconds for API compatibility
- **Error Normalization**: Standardize API error responses

### UI/UX Design

#### 1. Goals List Page Layout
- **Responsive Table**: Card layout on mobile, table on desktop
- **Search and Filters**: Top section with search input and status filter
- **Goal Cards/Rows**: Display goal title, status, deadline, progress
- **Action Buttons**: Edit, Delete, Status change per goal
- **Pagination**: Bottom pagination for large lists
- **Create Button**: Prominent "Create New Goal" button

#### 2. Goals Edit Page Layout
- **Goal Details Section**: Editable goal information
- **Task Management Section**: Task list with CRUD operations
- **Navigation**: Back to list, Create new goal buttons
- **Responsive Design**: Single column on mobile, side-by-side on desktop

#### 3. Goal Creation Form Layout
- **Responsive Grid**: Single column on mobile, 2-column on desktop
- **Field Groups**:
  - Basic Information: title, description, deadline, category
  - NLP Questions: Well-formed outcome questions section
  - Actions: Create, Cancel, Reset buttons
- **Form Actions**: Create Goal, Generate Image, Suggest Improvements

#### 4. Accessibility Features
- **Labels**: Proper `label` elements for all form fields
- **Roles**: Appropriate ARIA roles for form elements
- **Keyboard Navigation**: Full keyboard accessibility
- **Screen Reader**: Descriptive error messages and field labels
- **Focus Management**: Proper focus flow and error focus

#### 5. Loading and Error States
- **Loading Skeleton**: Show loading state while validating
- **Form Submission**: Disable form during creation with loading indicator
- **Error Display**: Show field-level and form-level errors
- **Success Feedback**: Toast notification on successful operations

### Backend Integration

#### 1. DynamoDB Operations
- **Table**: `gg_core` (single-table design)
- **Primary Key**: `USER#{userId}` / `GOAL#{goalId}`
- **GSI Updates**: Update GSI1PK/GSI1SK for goal listings
- **Validation**: Server-side validation in quest-service FastAPI endpoint

#### 2. Goal CRUD Operations
- **Create Flow**: Validation → Store goal → Set initial status to 'active'
- **Read Flow**: Fetch goal details → Load associated tasks
- **Update Flow**: Validate changes → Update goal → Update timestamps
- **Delete Flow**: Soft delete or hard delete with task cleanup
- **List Flow**: Query user goals with filtering and pagination

#### 3. Task Management Integration
- **Task Creation**: Create tasks associated with goals
- **Task Updates**: Update task status and details
- **Task Deletion**: Remove tasks when goal is deleted
- **Task Listing**: Load tasks for specific goals

### Backend Implementation

#### 1. Quest Service Enhancements (`backend/services/quest-service/`)
- **New Endpoints**:
  - `GET /goals` - List user goals with filtering and pagination
  - `GET /goals/{goal_id}` - Get single goal details
  - `PUT /goals/{goal_id}` - Update goal
  - `DELETE /goals/{goal_id}` - Delete goal
  - `GET /goals/{goal_id}/tasks` - Get tasks for specific goal
- **Enhanced Endpoints**:
  - `POST /goals` - Enhanced goal creation with validation
  - `POST /goals/{goal_id}/tasks` - Create task for specific goal

#### 2. DynamoDB Schema Updates
- **Goal Entity Pattern**:
  ```
  PK: USER#{userId}
  SK: GOAL#{goalId}
  GSI1PK: USER#{userId}
  GSI1SK: ENTITY#Goal#{createdAt}
  ```
- **Task Entity Pattern**:
  ```
  PK: USER#{userId}
  SK: TASK#{taskId}
  GSI1PK: USER#{userId}
  GSI1SK: ENTITY#Task#{createdAt}
  ```

#### 3. API Gateway Configuration
- **REST API Endpoints**: Configure new goal management endpoints
- **CORS Settings**: Update for new endpoints
- **Lambda Integration**: Connect endpoints to quest-service
- **Authentication**: JWT token validation for all endpoints

#### 4. Terraform Infrastructure Updates
- **Lambda Function**: Update quest-service with new endpoints
- **API Gateway**: Add new routes and methods
- **IAM Roles**: Update permissions for new operations
- **Environment Variables**: Add configuration for new features

### Testing Strategy

#### 1. Unit Tests
- **Goals List Component Tests**: List rendering, search, filtering, actions
  - Location: `frontend/src/pages/goals/__tests__/GoalsList.test.tsx`
  - **List Functionality Tests**:
    - Should display goals in responsive layout
    - Should filter goals by status and search term
    - Should handle edit and delete actions
    - Should navigate to goal creation form
- **Goals Edit Component Tests**: Goal editing, task management
  - Location: `frontend/src/pages/goals/__tests__/Goals.test.tsx`
  - **Edit Functionality Tests**:
    - Should load and display goal details
    - Should handle goal updates with validation
    - Should manage task list operations
    - Should navigate between pages
- **Goal Creation Form Tests**: Form rendering, validation, submission
  - Location: `frontend/src/components/forms/__tests__/GoalCreationForm.test.tsx`
  - **Form Validation Tests**:
    - Should validate required fields (title, deadline)
    - Should validate title length and format
    - Should validate deadline is future date
    - Should validate NLP answers are not empty
    - Should show appropriate error messages
- **API Service Tests**: Goal API functions and error handling
  - Location: `frontend/src/lib/__tests__/apiGoal.test.ts`
- **Model Tests**: TypeScript interfaces and data transformation
  - Location: `frontend/src/models/__tests__/goal.test.ts`
- **Validation Tests**: Zod schemas and business logic validation
  - Location: `frontend/src/lib/validation/__tests__/goalValidation.test.ts`

#### 2. Integration Tests
- **Goals List E2E Flow**: Login → Navigate to goals list → View goals → Edit goal → Delete goal
- **Goal Creation E2E Flow**: Login → Navigate to goals list → Create goal → Verify creation
- **Goal Edit E2E Flow**: Login → Navigate to goals list → Edit goal → Update goal → Manage tasks
- **API Integration**: Mock API calls, test error scenarios
- **Form Validation**: Test all validation rules and error messages
- **Automation**: Selenium-based tests in `tests/integration/goalManagementTest.js`
- **PowerShell Runner**: `scripts/run-goal-management-test.ps1`

### Infrastructure

#### 1. Terraform Configuration
- **Lambda Function**: Quest-service container deployment
- **API Gateway**: REST API endpoints for goal operations
- **DynamoDB**: Core table with GSI configuration
- **IAM Roles**: Least-privilege permissions for quest-service
- **SSM Parameters**: Environment configuration

#### 2. Environment Deployment
- **Dev Environment**: Full infrastructure deployment
- **Testing**: Automated deployment verification
- **Monitoring**: CloudWatch logs and X-Ray tracing

### Business Rules

#### 1. Goal Validation Rules
- **Title Requirements**: 3-100 characters, required field
- **Deadline Requirements**: Must be future date, required field
- **Description**: Optional, max 500 characters
- **NLP Answers**: All 8 questions must be answered
- **Category**: Optional, must be from predefined list or custom

#### 2. Form Behavior Rules
- **Real-time Validation**: Validate fields on blur/change
- **Submit Prevention**: Disable submit until all required fields valid
- **Error Display**: Show field-level errors immediately
- **Success Handling**: Clear form and show success message

### Security Considerations

#### 1. Data Validation
- **Input Sanitization**: Client and server-side validation
- **Type Safety**: Pydantic models for request/response
- **XSS Prevention**: Proper input escaping and validation

#### 2. Authorization
- **User Isolation**: Verify `userId` matches authenticated user
- **Field Permissions**: All goal fields editable by goal owner
- **Audit Logging**: Structured logs for goal creation

### Performance Optimization

#### 1. Form Optimization
- **Debounced Validation**: Reduce API calls during typing
- **Lazy Loading**: Load form data on component mount
- **Optimistic Updates**: Immediate UI feedback during submission

#### 2. API Optimization
- **Caching**: Browser caching for static assets
- **Compression**: API Gateway response compression
- **Connection Pooling**: DynamoDB connection optimization

## Implementation Phases

### Phase 1: Foundation Setup
1. Create or update `models/goal.ts` with TypeScript interfaces
2. Create `lib/validation/goalValidation.ts` with Zod schemas and i18n error messages
3. Create translation files following project pattern:
   - `i18n/goalList.ts` - GoalsList page translations
   - `i18n/goalEdit.ts` - Goals edit page translations
   - `i18n/goalCreation.ts` - GoalCreationForm translations
   - `i18n/goalActions.ts` - GoalActions component translations
   - `i18n/goalDashboard.ts` - Dashboard goals button translations
4. Create `components/forms/NLPQuestionsSection.tsx` component
5. Create `components/forms/GoalCategorySelector.tsx` component
6. Create `components/goals/GoalActions.tsx` component
7. Update existing `apiGoal.ts` with additional CRUD functions

### Phase 2: Goals List Page
1. Create `GoalsList.tsx` page with goal listing functionality
2. Implement search and filtering capabilities
3. Add goal action buttons (edit, delete, status change)
4. Implement responsive table/card layout
5. Add pagination for large goal lists

### Phase 3: Goals Edit Page Refactor
1. Refactor existing `Goals.tsx` to focus on goal editing
2. Remove goal list functionality (move to GoalsList.tsx)
3. Add "View Tasks" button to open existing TasksModal
4. Enhance task management section using existing modal
5. Add navigation between pages
6. Implement goal update functionality

### Phase 4: Goal Creation Form
1. Create `GoalCreationForm.tsx` component with basic form structure
2. Implement form fields with proper types and i18n labels
3. Integrate API service for data validation and submission
4. Add basic form validation and error handling
5. Implement responsive design with Tailwind

### Phase 5: Enhanced UX and Features
1. Add accessibility features (ARIA labels, keyboard navigation)
2. Implement real-time validation with debouncing
3. Add loading states and comprehensive error handling
4. Implement success/error feedback with translations
5. Add form reset and cancel functionality

### Phase 6: Dashboard Integration
1. Create `GoalsButton.tsx` component for dashboard
2. Integrate goals button into existing dashboard
3. Add active goals count display
4. Implement navigation to goals list

### Phase 7: Backend Implementation
1. Implement new quest-service endpoints
2. Update DynamoDB operations for CRUD
3. Configure API Gateway routes
4. Update Terraform infrastructure
5. Deploy and test backend changes

### Phase 8: Testing and Polish
1. Write unit tests for all new components and services
2. Create integration test automation with Selenium
3. Performance optimization and accessibility testing
4. Code review and documentation updates
5. Deploy to dev environment for testing

## Acceptance Criteria
- [ ] `models/goal.ts` created with proper TypeScript interfaces
- [ ] `lib/validation/goalValidation.ts` created with Zod schemas
- [ ] `GoalsList.tsx` page created with goal listing and management
- [ ] `Goals.tsx` refactored to focus on goal editing (goal list removed)
- [ ] "View Tasks" button added to open existing TasksModal
- [ ] `GoalCreationForm.tsx` component created following project patterns
- [ ] `NLPQuestionsSection.tsx` component created for reusable NLP questions
- [ ] `GoalCategorySelector.tsx` component created for category selection
- [ ] `GoalActions.tsx` component created for goal action buttons
- [ ] `GoalsButton.tsx` component created for dashboard integration
- [ ] All components use i18n translations with separate translation models per screen/component
- [ ] Translation files follow project pattern with TypeScript interfaces
- [ ] Error messages use translation keys for i18n support
- [ ] API integration in separate service file, not in components
- [ ] Goals list displays all goals with search and filtering
- [ ] Goals edit page shows goal details with task modal button
- [ ] Goal creation form renders all fields correctly with i18n labels
- [ ] Zod validation works for all field types with translated messages
- [ ] Real-time validation functions with proper error handling
- [ ] CRUD operations work via dedicated API service
- [ ] Dashboard shows goals button with active count
- [ ] Backend endpoints implemented for goal CRUD operations
- [ ] Responsive design works on mobile and desktop
- [ ] Accessibility standards met (WCAG 2.1 AA)
- [ ] Error states handled gracefully with translated messages
- [ ] Loading states provide good UX with i18n text
- [ ] Unit tests pass with >90% coverage for all new files
- [ ] Integration tests pass in automated environment
- [ ] Backend handles all edge cases and validation
- [ ] Terraform deployment succeeds in dev environment

## Files to be Created/Modified

### New Files
- `frontend/src/models/goal.ts`
- `frontend/src/lib/validation/goalValidation.ts`
- `frontend/src/i18n/goalList.ts`
- `frontend/src/i18n/goalEdit.ts`
- `frontend/src/i18n/goalCreation.ts`
- `frontend/src/i18n/goalActions.ts`
- `frontend/src/i18n/goalDashboard.ts`
- `frontend/src/pages/goals/GoalsList.tsx`
- `frontend/src/components/forms/GoalCreationForm.tsx`
- `frontend/src/components/forms/NLPQuestionsSection.tsx`
- `frontend/src/components/forms/GoalCategorySelector.tsx`
- `frontend/src/components/goals/GoalActions.tsx`
- `frontend/src/components/dashboard/GoalsButton.tsx`
- `frontend/src/pages/goals/__tests__/GoalsList.test.tsx`
- `frontend/src/pages/goals/__tests__/Goals.test.tsx`
- `frontend/src/components/forms/__tests__/GoalCreationForm.test.tsx`
- `frontend/src/lib/__tests__/apiGoal.test.ts`
- `frontend/src/models/__tests__/goal.test.ts`
- `frontend/src/lib/validation/__tests__/goalValidation.test.ts`
- `tests/integration/goalManagementTest.js`
- `scripts/run-goal-management-test.ps1`

### Modified Files
- `frontend/src/pages/goals/Goals.tsx` (refactor to focus on goal editing, remove goal list, add task modal button)
- `frontend/src/lib/apiGoal.ts` (add CRUD functions)
- `frontend/src/i18n/goals.ts` (add page-specific translations)
- `frontend/src/App.tsx` (add new routes)
- `frontend/src/pages/Dashboard.tsx` (add goals button)
- `backend/services/quest-service/app/main.py` (add new endpoints)
- `backend/infra/terraform2/` (update quest-service deployment)

## Technical Notes

### Page Architecture
The restructured goals functionality will follow the established project patterns:
- **Separation of Concerns**: Each page has a focused responsibility
- **Reusable Components**: Shared components for forms, actions, and displays
- **Type Safety**: Full TypeScript coverage with proper interfaces
- **Validation**: Client and server-side validation with Zod schemas
- **Accessibility**: WCAG 2.1 AA compliance with proper ARIA labels
- **i18n Support**: Full translation support with separate translation models per screen/component
- **Localization Pattern**: Following project convention with dedicated translation files per component

### Page Structure
The new page structure provides clear separation of functionality:
- **GoalsList.tsx**: Main entry point for goal management with listing and actions
- **Goals.tsx**: Goal editing page with task management (refactored from existing, goal list removed)
- **GoalCreationForm.tsx**: Dedicated form component for creating new goals
- **Dashboard Integration**: Goals button on dashboard for quick access
- **Task Management**: Uses existing TasksModal component via "View Tasks" button
- **Navigation Flow**: Seamless navigation between pages with proper state management

### Integration with Existing Code
The refactored structure will integrate seamlessly with existing functionality:
- **Preserve Task Management**: Use existing TasksModal component via "View Tasks" button
- **Remove Goal List**: Move goal listing functionality to dedicated GoalsList.tsx page
- **Dashboard Integration**: Add goals button to existing dashboard
- **Enhance User Experience**: Better organization and focused functionality per page
- **Maintain API Integration**: Use existing API services with additional CRUD functions
- **Backend Implementation**: Add new endpoints to existing quest-service
- **Localization Integration**: Follow existing i18n patterns with separate translation files
- **Follow Patterns**: Consistent with other page components in the project

### Testing Strategy
Comprehensive testing approach covering:
- **Unit Tests**: Individual component and function testing
- **Integration Tests**: End-to-end page navigation and form submission flows
- **Accessibility Tests**: Screen reader and keyboard navigation testing
- **Performance Tests**: Page responsiveness and API call optimization
- **Cross-browser Tests**: Compatibility across different browsers

### Route Structure
The new page structure will require the following routes:
- `/goals` - Goals list page (main entry point)
- `/goals/create` - Goal creation form
- `/goals/:id` - Goal editing page with task management
- `/goals/:id/edit` - Alternative route for goal editing

### Backend Implementation Details
The backend implementation includes:
- **New REST API Endpoints**: Complete CRUD operations for goals
- **DynamoDB Integration**: Proper single-table design patterns
- **Authentication**: JWT token validation for all endpoints
- **Terraform Updates**: Infrastructure as code for new endpoints
- **Error Handling**: Comprehensive error responses and validation

### Localization Implementation Details
The localization pattern follows the project's established conventions:
- **Separate Translation Files**: Each component/screen has its own translation file
- **TypeScript Interfaces**: Strongly typed translation structures
- **Three Languages**: English (en), Spanish (es), French (fr)
- **Nested Structure**: Organized by feature sections (forms, actions, validation, etc.)
- **Error Message Integration**: Validation errors use translation keys
- **Component Integration**: `useTranslation` hook for accessing translations

This implementation plan provides a complete roadmap for restructuring the goals functionality into focused, maintainable pages with full backend support and comprehensive localization, following the project's architectural patterns and quality standards while providing an improved user experience.
