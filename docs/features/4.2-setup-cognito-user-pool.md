## 4.2 – Setup Cognito User Pool
**Labels:** `Phase 1 – Foundation` (sky)

**Dependencies:**

> Dependencies: 3.1

### Description
Objective: Execute **4.2 – Setup Cognito User Pool** with precise steps that an AI agent can follow to completion.
Phase: Phase 1 – Foundation
Category: Auto-Inferred
Primary Domain(s): Backend (FastAPI, Python, AppSync/DynamoDB)
Dependencies: 3.1

Detailed Steps:
- Create or update FastAPI route(s) and handlers; define strict Pydantic models for request/response.
- Implement business logic in a separate service module; add structured logs and robust error handling.
- Use DynamoDB table `gg_core` with proper PK/SK; include createdAt/updatedAt; follow single-table patterns.
- Authorize via Cognito JWT; extract `sub` as userId; enforce RBAC if applicable.
- Document API changes in OpenAPI or AppSync schema; include error cases.

Acceptance Criteria (ALL must be met):
- Unit tests created and passing for all new code paths (task only succeeds if tests pass).
- Integration tests pass for end-to-end flow in dev.
- UAT scenario verified using acceptance steps; expected UX and API outputs confirmed.
- Static analysis, type checks, and security scans pass with no high/critical issues.
- Documentation updated (README/OpenAPI/AppSync schema).

Notes:
- Use structured JSON logs and defensive error handling.
- Secrets via SSM/KMS; never hardcode.
- Prefer idempotent operations for external calls.

Implementation Hints:
- Follow repository patterns for data access; include retries with backoff where relevant.
- Co-locate unit tests with modules (`tests/` for backend; `.test.tsx` for React components).
- Include Terraform plan in PR as evidence; document variables and state usage.


### Checklist — Work Items
- [ ] Implement core logic
- [ ] Add defensive error handling
- [ ] Write unit tests
- [ ] Document behavior

### Checklist — Quality & Delivery
- [ ] Unit tests written & passing (required)
- [ ] Integration tests passing
- [ ] UAT scenario verified
- [ ] Static analysis & style checks passing
- [ ] Security checks (deps, secrets, RBAC) passing
- [ ] Performance sanity check complete
- [ ] Documentation updated
- [ ] IaC updated & applied to dev — N/A if not infra
- [ ] Deployed to dev via CI/CD
- [ ] Smoke tests passed in dev
- [ ] Promote to staging (if applicable)
